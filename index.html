<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NAPPS Ogun | The Official Gateway Portal</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@600;700&family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --napps-green: #004d2c; 
            --gold: #d4af37; 
            --white: #ffffff;
            --off-white: #f8f9fa;
            --text-dark: #1a1a1a;
            --glass: rgba(255, 255, 255, 0.92);
            --shadow: 0 10px 40px rgba(0, 77, 44, 0.08);
        }

        * { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            font-family: 'Montserrat', sans-serif;
            background: var(--off-white);
            color: var(--text-dark);
            overflow-x: hidden;
            padding-bottom: 70px; 
        }

        /* --- HEADER --- */
        header {
            position: fixed; top: 0; width: 100%; z-index: 1000;
            background: var(--glass);
            backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
            border-bottom: 1px solid rgba(0,0,0,0.05);
            padding: 12px 5%;
            display: flex; justify-content: space-between; align-items: center;
        }

        .brand { display: flex; align-items: center; gap: 12px; text-decoration: none; }
        .brand img { height: 45px; width: auto; }
        .brand-text h1 { font-family: 'Cormorant Garamond'; font-size: 1.4rem; color: var(--napps-green); line-height: 1; font-weight: 700; }
        .brand-text span { font-size: 0.6rem; letter-spacing: 2px; text-transform: uppercase; color: var(--gold); font-weight: 700; }

        .desktop-nav { display: flex; gap: 25px; align-items: center; }
        .desktop-nav a { text-decoration: none; color: var(--napps-green); font-weight: 600; font-size: 0.8rem; text-transform: uppercase; transition: 0.3s; }
        .btn-action { padding: 10px 24px; background: var(--napps-green); color: white !important; border-radius: 50px; }

        /* --- HERO --- */
        .hero {
            position: relative; height: 80vh; min-height: 500px;
            background: linear-gradient(135deg, rgba(0, 77, 44, 0.85), rgba(0, 30, 15, 0.9)), 
                        url('https://images.unsplash.com/photo-1509062522246-3755977927d7?q=80&w=1600');
            background-size: cover; background-position: center;
            display: flex; align-items: center; justify-content: center; text-align: center;
            color: white; padding: 0 20px;
            clip-path: ellipse(150% 100% at 50% 0%);
        }

        .hero-content h1 { font-family: 'Cormorant Garamond'; font-size: clamp(2.5rem, 6vw, 4rem); margin-bottom: 20px; }

        /* --- TICKER --- */
        .bank-ticker-wrap {
            background: var(--napps-green); color: white; padding: 15px 0;
            overflow: hidden; margin: -40px auto 0; width: 90%;
            border-radius: 10px; position: relative; z-index: 10;
        }
        .ticker-move { display: flex; gap: 50px; animation: ticker 30s linear infinite; padding-left: 20px; }
        @keyframes ticker { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }

        /* --- DIRECTORY --- */
        .directory-section { padding: 80px 5%; max-width: 1200px; margin: 0 auto; }
        .search-bar { max-width: 600px; margin: 0 auto 40px; position: relative; }
        .search-bar input {
            width: 100%; padding: 18px 25px; border-radius: 50px; border: 2px solid #eee;
            font-family: 'Montserrat'; outline: none; transition: 0.3s;
        }
        .search-bar input:focus { border-color: var(--gold); }

        .school-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 25px; }
        .school-card {
            background: white; border-radius: 15px; overflow: hidden; border: 1px solid #eee;
            transition: 0.3s; position: relative;
        }
        .school-card:hover { transform: translateY(-5px); box-shadow: var(--shadow); }
        .school-img { height: 180px; width: 100%; object-fit: cover; background: #f0f0f0; }
        .school-info { padding: 20px; }
        .school-badge { 
            position: absolute; top: 15px; right: 15px; background: var(--gold); color: var(--napps-green); 
            font-size: 0.6rem; font-weight: 800; padding: 4px 8px; border-radius: 4px; 
        }

        /* --- MOBILE NAV --- */
        .mobile-nav {
            display: none; position: fixed; bottom: 0; left: 0; width: 100%; height: 70px;
            background: white; z-index: 1000; border-top: 1px solid #eee;
            justify-content: space-around; align-items: center;
        }

        @media (max-width: 900px) {
            .desktop-nav { display: none; }
            .mobile-nav { display: flex; }
        }
    </style>
</head>
<body>

    <header>
        <a href="index.html" class="brand">
            <img src="https://via.placeholder.com/100x100/004d2c/d4af37?text=N" alt="NAPPS Logo">
            <div class="brand-text">
                <h1>NAPPS</h1>
                <span>OGUN STATE CHAPTER</span>
            </div>
        </a>
        <nav class="desktop-nav">
            <a href="index.html">Home</a>
            <a href="teacher-reg.html">Teachers</a>
            <a href="register.html" class="btn-action">JOIN NAPPS</a>
        </nav>
    </header>

    <section class="hero">
        <div class="hero-content">
            <h1>The Unified Portal for<br>Private Education</h1>
            <p>Empowering schools and teachers across the Gateway State.</p>
        </div>
    </section>

    <div class="bank-ticker-wrap">
        <div class="ticker-move">
            <span><b>ECO BANK:</b> 0990147139 (NAPPS State Dues)</span>
            <span><b>ECO BANK:</b> 0990147139 (Unified Exam Fees)</span>
            <span><b>ECO BANK:</b> 0990147139 (Project Levy)</span>
            <span><b>ECO BANK:</b> 0990147139 (NAPPS State Dues)</span>
            <span><b>ECO BANK:</b> 0990147139 (Unified Exam Fees)</span>
        </div>
    </div>

    <section class="directory-section">
        <div style="text-align:center; margin-bottom:40px;">
            <h2 style="font-family:'Cormorant Garamond'; font-size:2.5rem; color:var(--napps-green);">Verified Institutions</h2>
            <p>Find accredited private schools in Ogun State.</p>
        </div>

        <div class="search-bar">
            <input type="text" id="searchInput" placeholder="Search by school name or location...">
        </div>

        <div class="school-grid" id="schoolContainer">
            <div style="grid-column: 1/-1; text-align:center; padding: 50px;">
                <i class="fas fa-spinner fa-spin" style="font-size: 2rem; color: var(--gold);"></i>
                <p style="margin-top:10px;">Syncing with Registry...</p>
            </div>
        </div>
    </section>

    <nav class="mobile-nav">
        <a href="index.html" style="color:var(--napps-green);"><i class="fas fa-home"></i></a>
        <a href="teacher-reg.html"><i class="fas fa-chalkboard-teacher"></i></a>
        <a href="register.html"><i class="fas fa-plus-circle"></i></a>
    </nav>

    <script>
    let allSchools = [];
    const container = document.getElementById('schoolContainer');

    // 1. Fetch Data with the correct 'type' parameter
    async function loadDirectory() {
        try {
            // Added ?type=schools to be explicit
            const response = await fetch('/.netlify/functions/api?type=schools');
            if(!response.ok) throw new Error("Could not reach API");
            
            allSchools = await response.json();
            renderSchools(allSchools);
        } catch (error) {
            console.error("Error:", error);
            container.innerHTML = `<p style="grid-column:1/-1; text-align:center; color:red; padding:20px;">
                <i class="fas fa-exclamation-triangle"></i><br>
                Unable to load directory. Please try again later.</p>`;
        }
    }

    // 2. Render Cards (Mapping 'image' and 'location' from your SQL)
    function renderSchools(data) {
        if(data.length === 0) {
            container.innerHTML = `<p style="grid-column:1/-1; text-align:center; padding:50px;">No verified schools found.</p>`;
            return;
        }

        container.innerHTML = data.map(school => `
            <div class="school-card">
                ${school.status === 'verified' ? '<div class="school-badge">VERIFIED</div>' : ''}
                
                <img src="${school.image || 'https://via.placeholder.com/400x200?text=NAPPS+Institution'}" 
                     class="school-img" 
                     alt="${school.name}">
                
                <div class="school-info">
                    <h3 style="font-family:'Cormorant Garamond'; font-size:1.4rem;">${school.name}</h3>
                    <p style="font-size:0.85rem; color:#666; margin-top:5px;">
                        <i class="fas fa-map-marker-alt" style="color:var(--gold)"></i> ${school.location}
                    </p>
                    <a href="tel:${school.phone}" style="display:block; text-decoration:none; width:100%; margin-top:15px; padding:10px; border:none; background:var(--off-white); font-weight:700; color:var(--napps-green); border-radius:5px; text-align:center; font-size:0.8rem;">
                        <i class="fas fa-phone"></i> CALL SCHOOL
                    </a>
                </div>
            </div>
        `).join('');
    }

    // 3. Search Filter Logic (Matches 'name' and 'location')
    document.getElementById('searchInput').addEventListener('input', (e) => {
        const term = e.target.value.toLowerCase();
        const filtered = allSchools.filter(s => 
            s.name.toLowerCase().includes(term) || 
            (s.location && s.location.toLowerCase().includes(term))
        );
        renderSchools(filtered);
    });

    // Initialize the portal
    loadDirectory();
</script>
</body>
</html>