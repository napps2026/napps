<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Photo Gallery | NAPPS Ogun</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --napps-green: #004d2c; --gold: #d4af37; --bg: #ffffff; }
        body { font-family: 'Montserrat', sans-serif; background: #f9f9f9; margin: 0; }
        
        header { background: var(--napps-green); color: white; padding: 60px 20px; text-align: center; }
        header h1 { margin: 0; font-size: 2.5rem; }
        header p { opacity: 0.9; margin-top: 10px; }

        .gallery-container { max-width: 1200px; margin: 40px auto; padding: 0 20px; }
        
        /* Masonry-style Grid */
        .gallery-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); 
            gap: 20px; 
        }

        .gallery-item { 
            background: white; 
            border-radius: 12px; 
            overflow: hidden; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.08); 
            cursor: pointer; 
            transition: transform 0.3s ease;
        }
        .gallery-item:hover { transform: scale(1.02); }

        .gallery-item img { 
            width: 100%; 
            height: 250px; 
            object-fit: cover; 
            display: block; 
        }

        .gallery-info { padding: 15px; border-top: 3px solid var(--gold); }
        .gallery-info h3 { margin: 0; font-size: 1rem; color: var(--napps-green); }
        .gallery-info span { font-size: 0.75rem; color: #888; }

        /* Lightbox Overlay */
        #lightbox {
            position: fixed; inset: 0; background: rgba(0,0,0,0.9);
            display: none; align-items: center; justify-content: center;
            z-index: 3000; padding: 20px;
        }
        #lightbox img { max-width: 90%; max-height: 80vh; border: 3px solid white; border-radius: 5px; }
        #lightbox .close { position: absolute; top: 20px; right: 30px; color: white; font-size: 40px; cursor: pointer; }

        .loader { text-align: center; padding: 50px; font-weight: 600; color: var(--napps-green); }
    </style>
</head>
<body>

    <header>
        <h1>NAPPS Ogun Gallery</h1>
        <p>Capturing Excellence in Private Education</p>
    </header>

    <div class="gallery-container">
        <div id="loader" class="loader"><i class="fas fa-circle-notch fa-spin"></i> Loading Moments...</div>
        <div class="gallery-grid" id="galleryGrid"></div>
    </div>

    <div id="lightbox" onclick="this.style.display='none'">
        <span class="close">&times;</span>
        <img id="lightboxImg" src="">
        <div id="lightboxCaption" style="color: white; position: absolute; bottom: 10%; font-weight: 600;"></div>
    </div>

    <script>
        async function loadGallery() {
            try {
                // Fetches 'verified' gallery items from your api.js
                const response = await fetch('/.netlify/functions/api?type=gallery');
                const photos = await response.json();
                
                const grid = document.getElementById('galleryGrid');
                const loader = document.getElementById('loader');
                
                if (photos.length === 0) {
                    loader.innerHTML = "No photos published yet.";
                    return;
                }

                grid.innerHTML = photos.map(photo => `
                    <div class="gallery-item" onclick="openLightbox('${photo.url}', '${photo.title}')">
                        <img src="${photo.url}" alt="${photo.title}" loading="lazy">
                        <div class="gallery-info">
                            <h3>${photo.title}</h3>
                            <span><i class="far fa-calendar-alt"></i> ${new Date(photo.created_at).toLocaleDateString()}</span>
                        </div>
                    </div>
                `).join('');
                
                loader.style.display = 'none';
            } catch (err) {
                document.getElementById('loader').innerHTML = "Error loading gallery.";
            }
        }

        function openLightbox(url, title) {
            document.getElementById('lightboxImg').src = url;
            document.getElementById('lightboxCaption').innerText = title;
            document.getElementById('lightbox').style.display = 'flex';
        }

        loadGallery();
    </script>
</body>
</html>