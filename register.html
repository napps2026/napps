<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NAPPS Ogun | Institutional Enrollment</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@600;700&family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root { 
            --primary: #051a13; 
            --accent: #c5a028; 
            --accent-light: #e6c860;
            --bg: #f4f1ea;
            --white: #ffffff;
            --glass: rgba(255, 255, 255, 0.8);
        }

        * { margin:0; padding:0; box-sizing:border-box; }

        body { 
            background: var(--bg); 
            font-family: 'Montserrat', sans-serif; 
            color: var(--primary); 
            min-height: 100vh; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            overflow-x: hidden;
            /* Animated Background Blobs for an "Advanced" feel */
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(197, 160, 40, 0.05) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(5, 26, 19, 0.05) 0%, transparent 20%);
        }

        /* FIXED STICKY HOME BUTTON */
        .fixed-nav {
            position: fixed;
            top: 0; left: 0; width: 100%;
            padding: 20px;
            z-index: 2000;
            pointer-events: none; /* Allows clicking through the container */
        }
        .back-home {
            pointer-events: auto; /* Re-enables clicking for the button */
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 12px 20px;
            background: var(--primary);
            color: var(--accent);
            text-decoration: none;
            border-radius: 50px;
            font-weight: 700;
            font-size: 0.75rem;
            letter-spacing: 1px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.15);
            transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .back-home:hover { transform: scale(1.05); background: var(--accent); color: var(--primary); }

        /* ADVANCED PROGRESS TRACKER */
        .progress-bar {
            display: flex;
            justify-content: space-between;
            margin-bottom: 40px;
            position: relative;
        }
        .progress-bar::before {
            content: '';
            position: absolute;
            top: 50%; left: 0; width: 100%; height: 2px;
            background: #ddd; transform: translateY(-50%);
            z-index: 1;
        }
        .step {
            width: 35px; height: 35px; background: var(--white);
            border: 2px solid #ddd; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            z-index: 2; font-weight: 700; font-size: 0.8rem;
            transition: 0.4s; color: #aaa;
        }
        .step.active { border-color: var(--accent); background: var(--accent); color: var(--primary); box-shadow: 0 0 15px rgba(197, 160, 40, 0.4); }
        .step.done { border-color: var(--primary); background: var(--primary); color: var(--accent); }

        /* MAIN CONTAINER */
        .reg-container { 
            max-width: 500px; width: 92%; 
            background: var(--glass); 
            backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
            padding: 40px; border-radius: 40px; 
            border: 1px solid rgba(255,255,255,0.5);
            box-shadow: 0 30px 60px rgba(5, 26, 19, 0.1);
            margin-top: 60px;
        }

        .phase { display: none; }
        .phase.active { display: block; animation: slideUp 0.6s ease-out; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }

        h2 { font-family: 'Cormorant Garamond'; font-size: 2.4rem; text-align: center; color: var(--primary); margin-bottom: 30px; }

        /* INPUT STYLES */
        .field-group { margin-bottom: 25px; }
        label { display: block; font-size: 0.65rem; font-weight: 800; text-transform: uppercase; letter-spacing: 1.5px; color: #777; margin-bottom: 8px; margin-left: 5px;}
        
        .input-box {
            background: var(--white);
            border: 1px solid #eee;
            border-radius: 15px;
            padding: 12px 18px;
            display: flex; align-items: center;
            transition: 0.3s;
        }
        .input-box:focus-within { border-color: var(--accent); box-shadow: 0 5px 15px rgba(197, 160, 40, 0.1); }
        .input-box i { color: var(--accent); margin-right: 15px; font-size: 1rem; }
        .input-box input, .input-box select { border: none; outline: none; width: 100%; font-family: 'Montserrat'; font-size: 0.9rem; background: transparent; }

        /* UPLOAD AREA */
        .upload-area {
            border: 2px dashed #ccc; border-radius: 20px;
            padding: 30px; text-align: center; cursor: pointer;
            transition: 0.3s; background: rgba(255,255,255,0.5);
            position: relative; overflow: hidden;
        }
        .upload-area:hover { border-color: var(--accent); background: var(--white); }
        .upload-area i { font-size: 2rem; color: var(--accent); margin-bottom: 10px; }
        .upload-area p { font-size: 0.75rem; font-weight: 600; color: #666; }
        
        #preview-container { margin-top: 15px; display: none; }
        #preview-container img { width: 80px; height: 80px; object-fit: cover; border-radius: 12px; border: 2px solid var(--accent); }

        /* PAYMENT CARD */
        .payment-card { 
            background: linear-gradient(135deg, var(--primary) 0%, #0a3325 100%);
            color: white; padding: 30px; border-radius: 25px;
            margin-bottom: 25px; position: relative;
            box-shadow: 0 15px 35px rgba(5, 26, 19, 0.3);
        }
        .payment-card::after {
            content: '\f19c'; font-family: 'Font Awesome 5 Free'; font-weight: 900;
            position: absolute; right: 20px; bottom: 10px; font-size: 4rem; opacity: 0.05;
        }
        .acc-no { font-size: 1.8rem; letter-spacing: 4px; color: var(--accent-light); margin: 15px 0; font-family: 'Cormorant Garamond'; }

        /* BUTTONS */
        .btn-main {
            width: 100%; padding: 20px; border: none; border-radius: 18px;
            background: var(--primary); color: var(--accent);
            font-weight: 800; letter-spacing: 2px; cursor: pointer;
            transition: 0.3s; position: relative; overflow: hidden;
        }
        .btn-main:hover { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(0,0,0,0.2); }
        
        .btn-main.loading { pointer-events: none; opacity: 0.8; }
        .btn-main .loader { display: none; margin-left: 10px; }
        .btn-main.loading .loader { display: inline-block; animation: spin 1s linear infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        @media(max-width: 480px) {
            .reg-container { padding: 30px 20px; }
            h2 { font-size: 1.8rem; }
        }
    </style>
</head>

<body>

    <div class="fixed-nav">
        <a href="index.html" class="back-home">
            <i class="fas fa-home"></i> BACK TO HOME
        </a>
    </div>

    <div class="reg-container">
        <div class="progress-bar">
            <div class="step active" id="step1">1</div>
            <div class="step" id="step2">2</div>
            <div class="step" id="step3"><i class="fas fa-check"></i></div>
        </div>

        <div class="phase active" id="phase1">
            <h2>School Data</h2>
            
            <div class="field-group">
                <label>Institutional Name</label>
                <div class="input-box">
                    <i class="fas fa-school"></i>
                    <input type="text" id="sName" placeholder="e.g. Royal Gateway Academy">
                </div>
            </div>

            <div class="field-group">
                <label>LGA / Region</label>
                <div class="input-box">
                    <i class="fas fa-map-marker-alt"></i>
                    <select id="sLga">
                        <option value="" disabled selected>Select LGA</option>
                        <option>Abeokuta South</option>
                        <option>Abeokuta North</option>
                        <option>Ifo / Ota</option>
                        <option>Ijebu Ode</option>
                    </select>
                </div>
            </div>

            <div class="field-group">
                <label>School Logo</label>
                <div class="upload-area" onclick="document.getElementById('sImg').click()">
                    <i class="fas fa-image"></i>
                    <p id="sImgName">Click to upload logo</p>
                    <div id="preview-container"><img id="preview-img" src=""></div>
                    <input type="file" id="sImg" accept="image/*" style="display:none">
                </div>
            </div>

            <button class="btn-main" onclick="toPayment()">
                NEXT PHASE <i class="fas fa-arrow-right" style="margin-left:10px"></i>
            </button>
        </div>

        <div class="phase" id="phase2">
            <h2>Payment</h2>
            <p style="text-align:center; font-size: 0.8rem; margin-bottom: 20px; color: #666;">Verification Fee: <b>â‚¦5,000.00</b></p>
            
            <div class="payment-card">
                <p style="font-size: 0.6rem; opacity: 0.7; letter-spacing: 2px;">BANK ACCOUNT FOR DEPOSIT</p>
                <div class="acc-no">0990147139</div>
                <p style="font-weight: 700;">Eco Bank</p>
                <p style="font-size: 0.7rem; color: var(--accent-light);">National Association of Proprietors of Private Schools</p>
            </div>

            <div class="field-group">
                <label>Proof of Payment</label>
                <div class="upload-area" onclick="document.getElementById('receiptImg').click()">
                    <i class="fas fa-file-invoice-dollar"></i>
                    <p id="receiptName">Upload Screenshot / Receipt</p>
                    <input type="file" id="receiptImg" accept="image/*" style="display:none">
                </div>
            </div>

            <button class="btn-main" id="finalBtn" onclick="submitRegistration()">
                <span>SYNC TO CLOUD</span>
                <i class="fas fa-circle-notch loader"></i>
            </button>
        </div>

        <div class="phase" id="phase3" style="text-align:center;">
            <div style="font-size: 4rem; color: var(--accent); margin-bottom: 20px;"><i class="fas fa-check-circle"></i></div>
            <h2>Submission Sent</h2>
            <p style="color: #666; line-height: 1.6; font-size: 0.9rem;">
                Your enrollment packet is now being reviewed by the Council. You will be notified via phone once your "Verified" badge is active.
            </p>
            <a href="index.html" class="btn-main" style="display:block; margin-top: 30px; text-decoration: none;">
                FINISH & EXIT
            </a>
        </div>
    </div>

    <script>
        // LOGIC - UI Navigation
        function toPayment() {
            if(!document.getElementById('sName').value || !document.getElementById('sImg').files[0]) {
                return alert("Please complete all fields and upload logo");
            }
            document.getElementById('phase1').classList.remove('active');
            document.getElementById('phase2').classList.add('active');
            document.getElementById('step1').classList.add('done');
            document.getElementById('step2').classList.add('active');
        }

        // LOGIC - Image Previews
        document.getElementById('sImg').onchange = function(e) {
            const file = e.target.files[0];
            document.getElementById('sImgName').innerText = file.name;
            
            // Show Live Preview
            const reader = new FileReader();
            reader.onload = function(event) {
                document.getElementById('preview-img').src = event.target.result;
                document.getElementById('preview-container').style.display = 'block';
            }
            reader.readAsDataURL(file);
        };

        document.getElementById('receiptImg').onchange = (e) => {
            document.getElementById('receiptName').innerText = e.target.files[0].name;
            document.getElementById('receiptName').style.color = "var(--primary)";
        };

        // LOGIC - Data Syncing (Maintaining your existing API logic)
        async function submitRegistration() {
            const btn = document.getElementById('finalBtn');
            const receipt = document.getElementById('receiptImg').files[0];
            
            if(!receipt) return alert("Please upload payment receipt");

            btn.classList.add('loading');
            btn.querySelector('span').innerText = "STREAMING...";

            // Convert logo to Base64 (stored in image_url field)
            const sImgFile = document.getElementById('sImg').files[0];
            const sImgBase = sImgFile ? await toBase64(sImgFile) : null;

            const payload = {
                name: document.getElementById('sName').value,
                location: document.getElementById('sLga').value,
                image_url: sImgBase,
                contact: ''
            };

            try {
                const res = await fetch('/.netlify/functions/register-school', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const json = await res.json();
                if(res.ok && json.success) {
                    document.getElementById('phase2').classList.remove('active');
                    document.getElementById('phase3').classList.add('active');
                    document.getElementById('step2').classList.add('done');
                    document.getElementById('step3').classList.add('active');
                } else {
                    throw new Error(json.error || 'Registration failed');
                }
            } catch(err) {
                console.error(err);
                alert("Cloud Sync Error. Please check connection.");
                btn.classList.remove('loading');
                btn.querySelector('span').innerText = "RETRY SYNC";
            }
        }

        const toBase64 = file => new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = () => resolve(reader.result);
            reader.onerror = error => reject(error);
        });
    </script>
</body>
</html>