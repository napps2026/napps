<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Find Teachers | NAPPS Ogun State</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --napps-green: #004d2c; --gold: #d4af37; --text: #333; }
        body { font-family: 'Montserrat', sans-serif; background: #f4f7f6; color: var(--text); margin: 0; }
        
        .hero { background: var(--napps-green); color: white; padding: 60px 20px; text-align: center; }
        .search-container { max-width: 800px; margin: -30px auto 40px; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); display: flex; gap: 10px; }
        
        select, input { flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-family: inherit; }
        
        .teacher-grid { max-width: 1100px; margin: 0 auto; display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 25px; padding: 20px; }
        .teacher-card { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.05); transition: 0.3s; position: relative; border-top: 5px solid var(--gold); }
        .teacher-card:hover { transform: translateY(-5px); }
        
        .profile-img { width: 100%; height: 200px; object-fit: cover; background: #eee; }
        .card-content { padding: 20px; }
        .card-content h3 { margin: 0 0 5px; color: var(--napps-green); }
        .badge { background: #e8f5e9; color: var(--napps-green); padding: 4px 10px; border-radius: 20px; font-size: 0.75rem; font-weight: 700; display: inline-block; margin-bottom: 15px; }
        
        .contact-btn { display: block; text-align: center; background: var(--napps-green); color: white; padding: 10px; text-decoration: none; border-radius: 6px; font-weight: 600; margin-top: 15px; transition: 0.3s; }
        .contact-btn:hover { background: var(--gold); }
        
        #loader { text-align: center; padding: 50px; font-size: 1.2rem; color: #666; }
    </style>
</head>
<body>

    <section class="hero">
        <h1>Teacher Discovery Portal</h1>
        <p>Connecting Qualified Educators with Approved Private Schools</p>
    </section>

    <div class="search-container">
        <input type="text" id="nameSearch" placeholder="Search by name..." oninput="filterTeachers()">
        <select id="qualFilter" onchange="filterTeachers()">
            <option value="">All Qualifications</option>
            <option value="NCE">NCE</option>
            <option value="B.Ed / B.Sc / B.A">Degree (B.Ed/B.Sc/B.A)</option>
            <option value="PGDE">PGDE</option>
            <option value="M.Ed / M.Sc">Masters</option>
            <option value="PhD">PhD</option>
        </select>
    </div>

    <div id="loader"><i class="fas fa-spinner fa-spin"></i> Loading educators...</div>
    <div class="teacher-grid" id="teacherGrid"></div>

    <script>
        let allTeachers = [];

        async function fetchTeachers() {
            try {
                // Note: Since this is a public page, your api.js GET logic needs a 
                // "public-teachers" type that doesn't require an Executive Key.
                // For now, we will use a key-based fetch or update your API.
                const response = await fetch('/.netlify/functions/api?type=teachers', {
                    headers: { 'Authorization': 'Bearer PUBLIC_ACCESS' } 
                });
                
                const data = await response.json();
                // Only show verified teachers to the public
                allTeachers = data.filter(t => t.status === 'verified');
                displayTeachers(allTeachers);
                document.getElementById('loader').style.display = 'none';
            } catch (err) {
                document.getElementById('loader').innerText = "Failed to load directory.";
            }
        }

        function displayTeachers(list) {
            const grid = document.getElementById('teacherGrid');
            grid.innerHTML = list.map(t => `
                <div class="teacher-card">
                    <img src="${t.image_url || 'https://via.placeholder.com/300x200?text=Profile+Photo'}" class="profile-img">
                    <div class="card-content">
                        <span class="badge">${t.qualification}</span>
                        <h3>${t.name}</h3>
                        <p style="font-size: 0.85rem; color: #666;">${t.bio || 'No bio provided.'}</p>
                        <a href="tel:${t.phone}" class="contact-btn">
                            <i class="fas fa-phone"></i> Call Teacher
                        </a>
                        <a href="mailto:${t.email}" class="contact-btn" style="background:#eee; color:#333; margin-top:5px;">
                            <i class="fas fa-envelope"></i> Email
                        </a>
                    </div>
                </div>
            `).join('');
        }

        function filterTeachers() {
            const name = document.getElementById('nameSearch').value.toLowerCase();
            const qual = document.getElementById('qualFilter').value;
            
            const filtered = allTeachers.filter(t => {
                return (t.name.toLowerCase().includes(name)) && 
                       (qual === "" || t.qualification === qual);
            });
            displayTeachers(filtered);
        }

        fetchTeachers();
    </script>
</body>
</html>